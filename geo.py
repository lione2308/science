import streamlit as st
import pandas as pd
import numpy as np

# --- 1. ë°ì´í„° ë¡œë“œ ë° ì „ì²˜ë¦¬ (ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©) ---
# ì‹¤ì œ ë°ì´í„° ì‚¬ìš© ì‹œ: pd.read_csv('your_geopark_data.csv', encoding='utf-8')
# ê³µê³µë°ì´í„°í¬í„¸ ë“±ì—ì„œ ë‹¤ìš´ë¡œë“œí•œ íŒŒì¼ì˜ ì»¬ëŸ¼ëª…ê³¼ ì¸ì½”ë”©ì„ ë§ì¶°ì£¼ì„¸ìš”.
@st.cache_data
def load_geopark_data():
    """êµ­ê°€ì§€ì§ˆê³µì› ì§€ì§ˆëª…ì†Œ ìƒ˜í”Œ ë°ì´í„°ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤."""
    # ìƒ˜í”Œ ë°ì´í„°: ì‹¤ì œ ì§€ì§ˆê³µì› ëª…ì¹­ ë° ëŒ€ëµì ì¸ ì¢Œí‘œ
    data = {
        'ì§€ì§ˆê³µì›ëª…': [
            'ì œì£¼ë„ êµ­ê°€ì§€ì§ˆê³µì›', 'ì²­ì†¡ êµ­ê°€ì§€ì§ˆê³µì›', 'ë¬´ë“±ì‚°ê¶Œ êµ­ê°€ì§€ì§ˆê³µì›',
            'í•œíƒ„ê°• êµ­ê°€ì§€ì§ˆê³µì›', 'ê°•ì›ê³ ìƒëŒ€ êµ­ê°€ì§€ì§ˆê³µì›', 'ë¶€ì‚° êµ­ê°€ì§€ì§ˆê³µì›'
        ],
        'ì§€ì§ˆëª…ì†Œëª…': [
            'ì‚°ë°©ì‚°', 'ìš©ì¶”í˜‘ê³¡', 'ì„œì„ëŒ€',
            'ì¬ì¸í­í¬', 'ê³ ì”¨ë™êµ´', 'ì˜¤ë¥™ë„'
        ],
        # ì„ì˜ì˜ ìœ„ë„(lat)ì™€ ê²½ë„(lon) ë°ì´í„°
        'ìœ„ë„': [33.245, 36.435, 35.107, 38.033, 37.262, 35.097],
        'ê²½ë„': [126.323, 129.294, 126.969, 127.172, 128.452, 129.117],
        'ì†Œì†ì§€ì—­': ['ì œì£¼', 'ê²½ë¶', 'ê´‘ì£¼/ì „ë‚¨', 'ê²½ê¸°/ê°•ì›', 'ê°•ì›', 'ë¶€ì‚°']
    }
    df = pd.DataFrame(data)
    # Streamlitì˜ st.map()ì€ 'lat'ê³¼ 'lon' ì»¬ëŸ¼ì„ ì‚¬ìš©í•˜ë¯€ë¡œ, ì»¬ëŸ¼ ì´ë¦„ì„ ë³€ê²½í•©ë‹ˆë‹¤.
    df.rename(columns={'ìœ„ë„': 'lat', 'ê²½ë„': 'lon'}, inplace=True)
    return df

geopark_df = load_geopark_data()

# --- 2. Streamlit ì•± ì¸í„°í˜ì´ìŠ¤ êµ¬ì„± ---

st.title("ğŸ—ºï¸ ëŒ€í•œë¯¼êµ­ êµ­ê°€ì§€ì§ˆê³µì› ì‹œê°í™”")
st.markdown("ì „êµ­ êµ­ê°€ì§€ì§ˆê³µì›ì˜ ì£¼ìš” ì§€ì§ˆëª…ì†Œë¥¼ ì§€ë„ì— í‘œì‹œí•©ë‹ˆë‹¤.")

st.sidebar.header("ğŸ“ ì§€ë„ í•„í„°")

# ì†Œì† ì§€ì—­ í•„í„° (ì‚¬ì´ë“œë°”)
selected_regions = st.sidebar.multiselect(
    'ì†Œì† ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”:',
    options=geopark_df['ì†Œì†ì§€ì—­'].unique(),
    default=geopark_df['ì†Œì†ì§€ì—­'].unique() # ê¸°ë³¸ì ìœ¼ë¡œ ì „ì²´ ì„ íƒ
)

# ë°ì´í„° í•„í„°ë§
filtered_df = geopark_df[geopark_df['ì†Œì†ì§€ì—­'].isin(selected_regions)]

# --- 3. ë°ì´í„° í‘œì‹œ ---
st.subheader("ğŸ“ ì§€ì§ˆê³µì› ëª…ì†Œ ë°ì´í„°")
st.dataframe(filtered_df[['ì§€ì§ˆê³µì›ëª…', 'ì§€ì§ˆëª…ì†Œëª…', 'ì†Œì†ì§€ì—­', 'lat', 'lon']], 
             use_container_width=True)

# --- 4. ì§€ë„ ì‹œê°í™” ---
st.subheader("ğŸŒ êµ­ê°€ì§€ì§ˆê³µì› ì§€ë„")

if not filtered_df.empty:
    # ì§€ë„ì˜ ì¤‘ì‹¬ ì¢Œí‘œ ì„¤ì • (í•„í„°ë§ëœ ë°ì´í„°ì˜ í‰ê·  ìœ„ë„/ê²½ë„)
    # ê¸°ë³¸ ì¤‘ì‹¬: ëŒ€ëµì ì¸ í•œêµ­ì˜ ì¤‘ì‹¬
    center_lat = filtered_df['lat'].mean() if not filtered_df.empty else 36.5
    center_lon = filtered_df['lon'].mean() if not filtered_df.empty else 127.5
    
    # st.mapì„ ì‚¬ìš©í•˜ì—¬ ì§€ë„ì— ë°ì´í„° í‘œì‹œ
    st.map(filtered_df, zoom=7)
    
    st.info(f"ì§€ë„ì— ì´ **{len(filtered_df)}**ê°œì˜ ëª…ì†Œê°€ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.")
    
else:
    st.warning("ì„ íƒí•˜ì‹  ì§€ì—­ì— í•´ë‹¹í•˜ëŠ” ì§€ì§ˆëª…ì†Œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")

st.markdown("---")
st.caption("Â© Streamlit GeoPark App (ìƒ˜í”Œ ë°ì´í„° ê¸°ë°˜)")
